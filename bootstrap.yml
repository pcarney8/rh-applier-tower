---
- name: Bootstrap
  hosts: bootstrap
  vars:
    openshift_login_url: "https://console.s9.core.rht-labs.com"
    openshift:
      common:
        client_binary: "/usr/bin/oc"
        admin_binary: "/usr/bin/oc adm"
    ci_cd:
      namespace: ci-cd
      display_name: CI/CD
    dev:
      namespace: dev
      display_name: Dev
    test:
      namespace: test
      description: This is a test env
      display_name: Test
    prod:
      namespace: prod
      description: This is a prod env
      display_name: Production
  tasks:
    - include_tasks: tasks/oc-setup.yml
      tags:
        - setup
        - login
    - include_role:
        name: casl-ansible/roles/openshift-login
      tags:
        - login
    #TESTING, NEED USER NAME AND PASSWORD
    - name: Create a project
      openshift_raw:
        api_version: v1
        kind: Project
        name: "{{ item.namespace }}"
        description: "{{ item.description }}"
        display_name: "{{ item.display_name }}"
        state: present
      with_items:
        - "{{ test }}"
        - "{{ prod }}"
    - name: replace project request params with variables
      template:
        src: "{{ playbook_dir }}/params/projectrequests/project.j2"
        dest: "{{ playbook_dir }}/params/projectrequests/{{ item.namespace }}"
      with_items:
        - "{{ ci_cd }}"
        - "{{ dev }}"
      when: target == "bootstrap" #Leaving this in here because it used to be a part of the single playbook
    - include_role:
        name: openshift-applier/roles/openshift-applier